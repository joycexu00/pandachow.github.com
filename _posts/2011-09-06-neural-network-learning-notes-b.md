---
layout: post
title: 神经网络学习笔记(二)
categories:
- research
tags:
- MATLAB
- Artificial Intelligence
- MATLAB Toolbox
- Mathematical Modeling
- Neuronic Network
- Algorithm
---

前一篇笔记多是讲的一些基本的前提, 也没有涉及到太多的理论部分, 数学模型请各位自行去参考一些专业的书籍, 这里也不再赘述. 这篇笔记主要侧重于在MATLAB中利用工具箱来实现神经网络, 不过在正式开始利用工具箱编程之前还是要了解一些注意事项.

## 组建 ANN 的注意事项
利用 MATLAB 软件提供的工具箱, 采用BP网络解决非线性问题是一种便捷, 有效的途径, 在使用的时候还是要注意以下几个问题.

### 神经元节点数

网络的输入和输出节点数是由实际问题的维数决定的, 与网络的性能是没有什么关系的. 而隐含层节点数的设计就非常重要了, 但是目前貌似也是没有统一的规范来解决这个问题. 但是一般我们就是采用下面这两个经验公式来确定:
$$!\sqrt{m+n}+a$$
或者
$$!l=\sqrt{0.43mn+0.12n^2+2.54m+0.77n+0.35+0.51}$$
其中, m, n分别是输入节点数目和输出节点数目; a是$$1~10$$之间的常数. 隐层的节点数目可以利用这两个公式来得到一个初始值, 然后利用逐步增长或者逐步修剪法来最终确定隐层神经元的数目.
需要说明的是, 这里的经验公式只是确定隐层节点数的参考方法, 并不是在任何情况下都是有用的. 对于一个没有任何规律, 杂乱无序, 拐点特别多的训练样本, 这个所谓的经验公式可能会完全失效. 因此可以采用一些方法来尽量避免这些问题:

  1. 清理样本中过大或者过小的"野点"数据
  2. 采样间隔需要疏密有度
  3. 训练样本容量需要大小适宜, 在尽量全面覆盖知识的前提下选择小一点的数据
  4. 输入, 输出的样本选择要配合机理分析, 因为只有输入和输出之间存在必然的因果关系时, 我们使用神经网络才有意义

### 数据预处理和后期处理
MATLAB中提供的数据预处理的方法有这么几个:

1. **归一化处理**: 将每个数据都变成[-1, 1]之间的数据, 所涉及的函数主要有mapminmax, postmnmx, tramnmx, 当然也可以利用公式: $$x_k=\frac{x_k-x_{min}}{x_{max}-x_{min}}$$.
2. **标准化处理**: 是将每组数据都化为均值为0, 方差为1的一组数据, 所涉及的函数主要有prestd, poststd, trastd.
3. **主成分分析**: 进行正交处理, 可以减少输入数据的维数, 所涉及的函数有prepca, trapca.
4. **回归分析和相关性分析**: 所用的函数为postrg等.

这些函数请自行help之.

### 学习速率的选定
学习速率的参数net.trainparam.lr不能选择的太大, 否则会出现算法不收敛的情况; 当然也不能太小了, 否则训练时间就太长了. 一般的经验选择的范围是$$0.01~0.1$$之间的值, 再根据训练过程中梯度变化和均方误差变化值来确定.

**应用实例**

这里我们通过实例来讲述如何在MATLAB中使用BP网络工具箱解决问题. 所选案例用一道老题,

#### 1. 问题的描述
公路测量主要包括公路客运量和公路货运量两个方面. 一般来说, 一个地区的公路运量需要和这个地区的人数, 机动车数量和公路面积有关, 本题的数据就不另外加表格了, 就直接在程序里面体现. 最后给出的问题就是依据前面10多年的数据来预测今年和明年的结果(也就是公路客运量和公路货运量).

#### 2. BP网络的求解过程
为了更详细的了解一下BP网络求解问题的过程, 可以把问题分成几个部分来解决:

1. 原始数据的输入
2. 数据的归一化
3. 网络训练
4. 对原始数据进行仿真
5. 将原始数据仿真的结果和已知样本进行对比
6. 对新数据进行仿真

当然了, 这些步骤几乎也是解决所有神经网络预测问题的步骤.
    
    clc
    %原始数据 
    %人数(单位：万人)
    sqrs=[20.55 22.44 25.37 27.13 29.45 30.10 30.96 34.06 36.42 38.09 39.13 39.99 ...
           41.93 44.59 47.30 52.89 55.73 56.76 59.17 60.63];
    %机动车数(单位：万辆)
    sqjdcs=[0.6 0.75 0.85 0.9 1.05 1.35 1.45 1.6 1.7 1.85 2.15 2.2 2.25 2.35 2.5 2.6...
            2.7 2.85 2.95 3.1];
    %公路面积(单位：万平方公里)
    sqglmj=[0.09 0.11 0.11 0.14 0.20 0.23 0.23 0.32 0.32 0.34 0.36 0.36 0.38 0.49 ... 
             0.56 0.59 0.59 0.67 0.69 0.79];
    %公路客运量(单位：万人)
    glkyl=[5126 6217 7730 9145 10460 11387 12353 15750 18304 19836 21024 19490 20433 ...
            22598 25107 33442 36836 40548 42927 43462];
    %公路货运量(单位：万吨)
    glhyl=[1237 1379 1385 1399 1663 1714 1834 4322 8132 8936 11099 11203 10524 11115 ...
            13320 16762 18673 20724 20803 21804];
    p=[sqrs;sqjdcs;sqglmj];  %输入数据矩阵
    t=[glkyl;glhyl];         %目标数据矩阵
    %利用premnmx函数对数据进行归一化
    [pn,minp,maxp,tn,mint,maxt]=premnmx(p,t); % 对于输入矩阵p和输出矩阵t进行归一化处理
    dx=[-1,1;-1,1;-1,1];                   %归一化处理后最小值为-1，最大值为1
    %BP网络训练
    net=newff(dx,[3,7,2],{'tansig','tansig','purelin'},'traingdx'); %建立模型，并用梯度下降法训练．
    net.trainParam.show=1000;               %1000轮回显示一次结果
    net.trainParam.Lr=0.05;                 %学习速度为0.05
    net.trainParam.epochs=50000;           %最大训练轮回为50000次
    net.trainParam.goal=0.65*10^(-3);     %均方误差
    net=train(net,pn,tn);                   %开始训练，其中pn,tn分别为输入输出样本
    %利用原始数据对BP网络仿真
    an=sim(net,pn);           %用训练好的模型进行仿真
    a=postmnmx(an,mint,maxt); % 把仿真得到的数据还原为原始的数量级；
    %本例因样本容量有限使用训练数据进行测试，通常必须用新鲜数据进行测试
    x=1990:2009;
    newk=a(1,:);
    newh=a(2,:);
    figure (2);
    subplot(2,1,1);plot(x,newk,'r-o',x,glkyl,'b--+')    %绘值公路客运量对比图；
    legend('网络输出客运量','实际客运量');
    xlabel('年份');ylabel('客运量/万人');
    subplot(2,1,2);plot(x,newh,'r-o',x,glhyl,'b--+')     %绘制公路货运量对比图；
    legend('网络输出货运量','实际货运量');
    xlabel('年份');ylabel('货运量/万吨');
    %利用训练好的网络进行预测
    % 当用训练好的网络对新数据pnew进行预测时，也应作相应的处理：
    pnew=[73.39 75.55
          3.9635 4.0975
          0.9880 1.0268];           %2010年和2011年的相关数据；
    pnewn=tramnmx(pnew,minp,maxp); %利用原始输入数据的归一化参数对新数据进行归一化；
    anewn=sim(net,pnewn);            %利用归一化后的数据进行仿真；
    anew=postmnmx(anewn,mint,maxt)  %把仿真得到的数据还原为原始的数量级；