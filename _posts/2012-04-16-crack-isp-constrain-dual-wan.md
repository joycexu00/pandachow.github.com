---
layout: post
category : technology
tagline: Crack the ISP restrictions.
tags : [Dual LAN, Router]
---

昨天总算收到了新的路由器，DualWAN社区的产品。特点很明显，能刷tomato，也有很好的社区支持。当然，我也是冲着这两点才购买的。以前没刷过也没用过OpenWrt，这次也是第一次用tomato。琢磨了一天，发现tomato果然支持的功能非常多，自定义的性能也是非常强大。

下面来说说如何用这货来实现双拨实现网速1+1=2的功能，首先当然是用正常方法登录路由，当然路由器的两个WAN口必须都已经接上交换机。下面分几个部分来针对不同的情况来说明：

## 同网双号
比如我手头有两个电信2M的ADSL，通过双WAN拨号就可以实现一个4M的带宽了。这种情况应该不太常见，原因很简单，4M的价格一般来说是小于2x2M的，与其这样折腾，还不如直接开一个4M的划算。不过要是在学生宿舍，同学回家或者不在上网，这样的方法还是有一定价值的。

方法应该说也是非常简单，直接在路由器的web界面中两个WAN口的PPPOE拨号界面分别输入两个帐号和密码即可。连上基本没有什么问题，但是连上之后其实是可以发现链接时间是不太一样的，一般会有1-2秒的时差。关于这个时差后面会有详述，但是对于双号的形式是没有任何差别的。

## 异网双号
情况与前面类似，只不过这里是两个不同的ISP，例如一个联通的ADSL，一个是电信的ADSL。这种情况也算比较常见吧，因为不同运营商直接还是有一定的区别的，暂时还不能做到互通互联，比如联通的号登录电信的站点有时候和比较卡，反之亦然。对于异网双号的情况需要对路由做一些简单的设置。

1. 禁用WAN2的DNS服务器：将WAN2的DNS服务器下拉框选择“使用下面的DNS服务器”，然后在“首选”和“备用”栏都填上“0.0.0.0”；
2. 双WAN模式下拉框选择为“智能路由”；
3. 在新增功能中选择指定出口规则，制定方法如下：

在规则中先添加上一些自己想制定的出口流量设置，比如：1.1.1.1-1.1.1.255的流量走WAN1的口，只需要在目的地址栏和指派栏相应天上即可。当然，在添加完自己制定的规则之后，还需要在后面继续制定两个规则，我们不妨称之为一号规则和二号规则。一号规则设置为TCP协议，端口设置为80；443，设置为WAN1。表示走80和443接口的信息流量全部走WAN1口。二号规则需要在指派栏选择为负载均衡，其他默认即可。

## 单/双物理WAN单号
这种情况就非常常见了，比如我手里只有一个PPPOE的号，现在嫌网速不够用。怎么办呢，只需要在路由的web界面中的两个WAN口中设置好两个PPPOE的帐号和密码就可以上了。当然，想成功没这么简单，绝大部分情况我们会发现两个PPPOE的帐号里面只有一个能连接上，第二个号往往会出现错误691的情况。这里就不能不提到前面说双号双拨的时候的1-2秒的时间差了。正是因为这个1-2秒的时间差，导致两个PPPOE的帐号实际上是WAN1已经先连接上，WAN2延迟1-2秒后再去拨号，必然会失败了。因此必须要两个PPPOE的号同时拨上才可以。那我们怎么解决呢？只需要再次点击web界面下方的保存设置，完了之后路由器会重新设置一次。当然，这样的成功率不是太高，我自己试验几乎需要5-6次才能成功实现双WAN同步登陆。

那么怎么办呢？这样总是不断地点总不是办法，需要找到GUI的根本执行命令才行。查了一下，点击保存设置相当于 kill -SIGHUP 1 命令，因此直接登陆 telnet 输入命令 kill -SIGHUP 1。看了一下，果然路由器的power灯瞬间变红了。等继续由红色变成绿色，登陆路由界面，果然成功实现了双拨。宿舍瞬间1M变2M，大呼过瘾啊。

这里是用的两个物理WAN口来实现的双拨，如果单WAN物理口也是类似，只需要在路由里面设置好单物理口即可，同样可以实现双倍的速度。但是关于单物理口和双物理口的具体区别和关系，暂时还不是很清楚。写到这里不禁觉得tomato实在是太强大了，当然OpenWrt应该也是很强大的，只是刚刚入手还没有太多的折腾。

## 参考资料
Tomato DualWan 官网：[http://www.dualwan.cn/](http://www.dualwan.cn/)

Tomato DualWan 论坛：[http://bbs.dualwan.cn/](http://bbs.dualwan.cn/)
